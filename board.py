import numpy as np
from enum import Enum

JUMP = 'jump'
PAY = 'pay'
ONE = 1
THREE = 3
FIVE = 5


class Nodes_Types(Enum):
    EMPTY = -1
    COURT = 1
    POLICE = 2
    LOTTERY = 3
    TAXES = 4
    HOME_OFFICE = 5
    BARBERSHOP = 6
    GARDEN = 7

    ORANGE = 8
    SURPRISE = 9

    @staticmethod
    def types_dict():
        return list(map(lambda c: c.value, Nodes_Types))


class Board:

    def __init__(self, num_players, starting_point=(1, 0), end_point=(21, 27)):
        self.board_w = 23
        self.board_h = 31
        self.starting_point = starting_point
        self.num_players = num_players

        self.state = np.full((self.board_h, self.board_w), -1, np.int8)

        self.transition_matrix = np.full((self.board_h, self.board_w), -1, np.int8)

        self.transition_dict = {}
        self.init_dict()

    def init_state(self):
        pass

    def init_transition(self):
        pass

    def init_dict(self):
        self.init_row0()
        self.init_row1()
        self.init_row2()
        self.init_row3()
        self.init_row4()
        self.init_row5()
        self.init_row6()
        self.init_row7()
        self.init_row8()
        self.init_row9()
        self.init_row10()
        self.init_row11()
        self.init_row12()
        self.init_row13()
        self.init_row14()
        self.init_row15()
        self.init_row16()
        self.init_row17()
        self.init_row18()
        self.init_row19()
        self.init_row20()
        self.init_row21()
        self.init_row22()

    def init_row22(self):
        self.transition_dict[(22, 29)] = {1: [(22, 28)], 3: [(22, 28)], 5: [(22, 28)], JUMP: [(21, 28)]}
        self.transition_dict[(22, 28)] = {1: [(21, 28)], 3: [(21, 28)], 5: [(21, 28)], JUMP: [(20, 27)]}
        self.transition_dict[(22, 27)] = {1: [(22, 26), (21, 27)], 3: [(21, 25), (19, 27)],
                                          5: [(21, 23), (20, 24), (17, 27)]}
        self.transition_dict[(22, 26)] = {1: [(21, 26)], 3: [(21, 24), (20, 27)], 5: [(18, 27), (19, 24), (21, 21)]}
        self.transition_dict[(22, 25)] = {1: [(21, 25)], 3: [(21, 27), (20, 24), (21, 23), (22, 26)],
                                          5: [(19, 27), (19, 24), (21, 21)]}
        self.transition_dict[(22, 24)] = {1: [(222, 224)], 3: [(222, 224)], 5: [(222, 224)]}
        self.transition_dict[(222, 224)] = {1: [(22, 25)], 3: [(21, 26), (21, 24)], 5: [(20, 27), (20, 24), (21, 22)]}
        # extra cell for waiting one turn
        self.transition_dict[(22, 23)] = {1: [(22, 24)], 3: [(22, 24)], 5: [(22, 24)]}
        self.transition_dict[(22, 21)] = {1: [(21, 21)], 3: [(21, 23), (21, 19), (20, 20)],
                                          5: [(19, 25), (22, 18), (21, 17), (19, 19), (20, 22)]}
        self.transition_dict[(22, 19)] = {1: [(21, 19), (22, 18)], 3: [(21, 21), (19, 19), (21, 17), (20, 20)],
                                          5: [(17, 19), (21, 15), (21, 23), (20, 22), (22, 16)]}
        self.transition_dict[(22, 18)] = {1: [(21, 18), (22, 19)], 3: [(21, 20), (20, 19), (21, 16), (22, 17)],
                                          5: [(18, 19), (21, 14), (20, 15), (21, 22), (20, 21), (22, 15)]}
        self.transition_dict[(22, 17)] = {1: [(22, 16)], 3: [(22, 14)], 5: [(21, 15), (21, 13)]}
        self.transition_dict[(22, 16)] = {1: [(22, 15)], 3: [(21, 14)], 5: [(22, 13), (21, 16), (20, 15)], PAY: 120}
        # BUY GLASSES
        self.transition_dict[(22, 15)] = {1: [(22, 14)], 3: [(21, 13), (21, 15)], 5: [(21, 17), (19, 15)],
                                          PAY: 95}  # BUY HAT
        self.transition_dict[(22, 14)] = {1: [(21, 14)], 3: [(22, 13), (21, 16), (20, 15)], 5: [(21, 18), (18, 15)]}
        self.transition_dict[(22, 13)] = {1: [(21, 13)], 3: [(21, 15)], 5: [(21, 17), (19, 15)]}

    def init_row21(self):
        self.transition_dict[(21, 30)] = {1: [(22, 29)], 3: [(22, 29)], 5: [(22, 29)]}
        self.transition_dict[(21, 29)] = {1: [], 3: [], 5: []}
        self.transition_dict[(21, 28)] = {}  # END
        self.transition_dict[(21, 27)] = {1: [(21, 26), (20, 27)], 3: [(21, 24), (18, 27)],
                                          5: [(21, 22), (19, 24), (16, 27)]}
        self.transition_dict[(21, 26)] = {1: [(21, 27), (22, 26), (21, 25)], 3: [(20, 24), (21, 23), (19, 27)],
                                          5: [(21, 21), (18, 24), (17, 27)]}
        self.transition_dict[(21, 25)] = {1: [(21, 24), (21, 26)], 3: [(19, 24), (21, 22), (20, 27)],
                                          5: [(21, 20), (17, 24), (18, 27)]}
        self.transition_dict[(21, 24)] = {1: [(21, 25), (21, 23), (20, 24)],
                                          3: [(22, 26), (18, 24), (21, 21), (21, 27)],
                                          5: [(21, 19), (16, 24), (19, 27), (17, 23), (17, 25),
                                              (20, 20)]}  # get surprise

        self.transition_dict[(21, 23)] = {1: [(22, 23), (21, 24), (21, 22)],
                                          3: [(22, 24), (21, 26), (19, 24), (22, 21), (21, 20)],
                                          5: [(21, 18), (22, 19), (20, 19), (17, 24), (20, 27), (20, 21)]}
        self.transition_dict[(21, 22)] = {1: [(21, 23), (21, 21)], 3: [(21, 25), (20, 24), (21, 19), (20, 20)],
                                          5: [(21, 17), (19, 19), (22, 18), (21, 27), (18, 24), (20, 22)]}
        self.transition_dict[(21, 21)] = {1: [(22, 21), (21, 22), (21, 20)],
                                          3: [(20, 21), (20, 19), (21, 18), (22, 19), (21, 24)],
                                          5: [(21, 16), (22, 17), (19, 18), (21, 26), (19, 24), (20, 22)]}
        self.transition_dict[(21, 20)] = {1: [(20, 20), (21, 21), (21, 19)],
                                          3: [(20, 22), (21, 17), (22, 18), (21, 23), (19, 19)],
                                          5: [(21, 15), (22, 16), (18, 18), (21, 25), (20, 24), (20, 22)]}

        self.transition_dict[(21, 19)] = {1: [(22, 19), (21, 20), (21, 18), (20, 19)],
                                          3: [(20, 21), (22, 17), (21, 22), (18, 19), (21, 16)],
                                          5: [(20, 22), (22, 15), (21, 14), (21, 24), (17, 20), (17, 18), (20, 15)]}
        self.transition_dict[(21, 18)] = {1: [(21, 19), (22, 18), (21, 17)],
                                          3: [(22, 16), (21, 15), (19, 19), (21, 21), (20, 20)],
                                          5: [(22, 14), (20, 22), (21, 13), (21, 23), (17, 19), (19, 15)]}
        self.transition_dict[(21, 17)] = {1: [(21, 18), (22, 17), (21, 16)],
                                          3: [(21, 14), (20, 15), (22, 15), (21, 20), (20, 19), (22, 19)],
                                          5: [(20, 13), (21, 14), (18, 15), (17, 19), (22, 21), (21, 22), (22, 13),
                                              (19, 15)]}
        self.transition_dict[(21, 16)] = {1: [(21, 17), (21, 15)],
                                          3: [(21, 13), (19, 15), (22, 16), (22, 18), (21, 19)],
                                          5: [(19, 13), (22, 14), (17, 15), (21, 21), (20, 20), (19, 19)]}
        self.transition_dict[(21, 15)] = {1: [(21, 16), (21, 14), (20, 15)],
                                          3: [(22, 13), (20, 13), (18, 15), (22, 17), (21, 18)],
                                          5: [(17, 14), (16, 15), (18, 13), (22, 15), (22, 19), (21, 20), (20, 19)]}
        self.transition_dict[(21, 14)] = {1: [(21, 13), (21, 15)],
                                          3: [(19, 13), (19, 15), (21, 17)],
                                          5: [(17, 13), (18, 14), (17, 15), (22, 18), (22, 16), (21, 19)]}
        self.transition_dict[(21, 13)] = {1: [(22, 13), (21, 14), (20, 13)],
                                          3: [(18, 13), (20, 15), (21, 16)],
                                          5: [(17, 14), (17, 12), (16, 13), (18, 15), (22, 17), (21, 18)]}

    def init_row20(self):
        pass

    def init_row19(self):
        pass

    def init_row18(self):
        pass

    def init_row17(self):
        pass

    def init_row16(self):
        pass

    def init_row15(self):
        pass

    def init_row14(self):
        pass

    def init_row13(self):
        pass

    def init_row12(self):
        pass

    def init_row11(self):
        correction = {
            (11, 30): {1: [(10, 30), (11, 30)], 3: [(8, 30), (12, 28)], 5: [(6, 30), (10, 28), (12, 26)], 'jump': []},
            (11, 28): {1: [(10, 28), (12, 28)], 3: [(13, 27), (12, 26)], 5: [(6, 28), (15, 27), (12, 24)], 'jump': []},
            (11, 25): {1: [(10, 25), (12, 25)], 3: [(12, 27), (8, 25), (12, 23), (13, 24)],
                       5: [(6, 25), (7, 24), (12, 29), (11, 28), (14, 27), (14, 23), (15, 24), (12, 21)], 'jump': []},
            (11, 21): {1: [(10, 22), (12, 23)], 3: [(8, 21), (12, 22), (12, 19), (13, 20)],
                       5: [(7, 22), (7, 20), (12, 25), (13, 24), (13, 18), (12, 17), (15, 20)], 'jump': []},
            (11, 20): {1: [(11, 19)], 3: [(12, 18)], 5: [(12, 20), (11, 17), (14, 18)], 'jump': []},
            (11, 19): {1: [(11, 18)], 3: [(12, 19), (12, 17), (13, 18)],
                       5: [(15, 18), (12, 21), (13, 20), (10, 17), (11, 16)], 'jump': []},
            (11, 18): {1: [(12, 18)], 3: [(12, 20), (14, 18), (11, 17)],
                       5: [(14, 20), (12, 22), (11, 21), (15, 17), (10, 16), (11, 15), (9, 17)], 'jump': []},
            (11, 17): {1: [(12, 17), (10, 17), (11, 16)], 3: [(12, 19), (13, 18), (10, 15), (12, 15), (8, 17), (9, 16)],
                       5: [(15, 18), (13, 20), (12, 21), (7, 18), (7, 16), (12, 14), (12, 15), (10, 15), (9, 16)],
                       'jump': []},
            (11, 16): {1: [(11, 17), (11, 15), (10, 16)], 3: [(12, 18), (12, 14), (10, 16), (9, 17), (8, 16)],
                       5: [(14, 18), (12, 20), (7, 17), (7, 15), (8, 16)], 'jump': []},
            (11, 15): {1: [(12, 17), (10, 15), (11, 16)], 3: [(12, 13), (12, 17), (11, 17), (10, 17), (9, 16)],
                       5: [(14, 13), (12, 11), (11, 12), (13, 18), (12, 20), (7, 16), (8, 17), (9, 16)], 'jump': []},
            (11, 12): {1: [(12, 12), (10, 12)], 3: [(12, 14), (12, 10)], 5: [(11, 15), (15, 13), (11, 9), (12, 8)],
                       'jump': []},
            (11, 9): {1: [(12, 9), (11, 8), (10, 9)], 3: [(8, 9), (9, 8), (12, 11), (12, 7), (14, 9), (13, 8)],
                      5: [(7, 10), (7, 8), (12, 13), (11, 12), (12, 5), (15, 8), (14, 7), (13, 8)], 'jump': []},
            (11, 8): {1: [(11, 9), (12, 8), (10, 8)], 3: [(8, 8), (9, 13), (12, 10), (12, 6), (9, 9)],
                      5: [(6, 8), (7, 9), (7, 7), (8, 10), (16, 8), (15, 7), (12, 12), (12, 4)], 'jump': []}}

        self.transition_dict.update(correction)
        self.transition_dict[(11, 8)] = {1: [], 3: [], 5: [], JUMP: []}
        self.transition_dict[(11, 7)] = {1: [], 3: [], 5: [], JUMP: []}
        self.transition_dict[(11, 6)] = {1: [], 3: [], 5: [], JUMP: []}
        self.transition_dict[(11, 5)] = {1: [], 3: [], 5: [], JUMP: []}
        self.transition_dict[(11, 1)] = {1: [], 3: [], 5: [], JUMP: []}

    def init_row10(self):
        self.transition_dict[(10, 30)] = {1: [(11, 30), (9, 30)], 3: [(7, 30), (12, 29)],
                                          5: [(5, 30), (11, 28), (12, 27)], JUMP: []}

    def init_row9(self):
        self.transition_dict[(9, 30)] = {1: [(10, 30), (11, 30)], 3: [(12, 30), (6, 30)], 5: [(5, 29), (12, 28)],
                                         JUMP: []}

    def init_row8(self):
        self.transition_dict[(8, 30)] = {1: [(9, 30), (7, 30)], 3: [(12, 30), (6, 30)], 5: [(5, 29), (12, 28)],
                                         JUMP: []}

    def init_row7(self):
        pass

    def init_row6(self):
        pass

    def init_row5(self):
        pass

    def init_row4(self):
        pass

    def init_row3(self):
        pass

    def init_row2(self):
        pass

    def init_row1(self):
        pass

    def init_row0(self):
        pass
